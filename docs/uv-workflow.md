# ğŸ¯ UV Workflow Guide - Dependency Management

This guide describes your optimal workflow for keeping all dependencies synchronized.

## ğŸ“‹ **Core Principle: UV as Source of Truth**

- **pyproject.toml** = Source of truth (modified by UV)
- **uv.lock** = Exact versions (generated by UV)
- **requirements*.txt** = Compatibility (generated from pyproject.toml)
- **environment.yml** = Conda support (manually synchronized)

## ğŸ”„ **Your Daily Workflow**

### **1. Adding a Dependency**
```bash
# Core dependency
uv add streamlit>=1.50.0

# Development dependency  
uv add --dev pytest>=8.0.0

# Sync other files
make sync-deps
```

### **2. Updating Dependencies**
```bash
# Update a specific dependency
uv add streamlit>=1.51.0  # Replaces the old version

# Update ALL dependencies
make update-deps  # Updates everything + syncs
```

### **3. Removing a Dependency**
```bash
# Remove a dependency
uv remove some-package

# Sync other files
make sync-deps
```

### **4. Regular Maintenance**
```bash
# Check for outdated dependencies
uv tree

# Update all dependencies (monthly)
make update-deps

# Verify everything works
make test
```

## ğŸ¯ **Custom Makefile Commands**

```bash
# Sync all files from pyproject.toml
make sync-deps

# Update all dependencies + sync
make update-deps

# Complete update workflow
make update-deps && make test
```

## ğŸ“‚ **What Each File Does**

### **pyproject.toml** (your main file)
- **Modified by**: `uv add`, `uv remove`
- **Contains**: Version ranges (`>=1.50.0`)
- **Usage**: Modern Python configuration

### **uv.lock** (auto-generated)
- **Modified by**: `uv sync`, `uv lock`
- **Contains**: Exact versions + hashes
- **Usage**: Exact reproducibility

### **requirements.txt** (auto-generated)
- **Modified by**: `make sync-deps`
- **Contains**: Core dependencies only
- **Usage**: pip/CI compatibility

### **requirements/requirements-dev.txt** (auto-generated) 
- **Modified by**: `make sync-deps`
- **Contains**: All dependencies (core + dev)
- **Usage**: Development setup with pip

### **environment.yml** (manually synchronized)
- **Modified by**: You, manually
- **Contains**: Python + system dependencies (ffmpeg)
- **Usage**: Conda support for contributors

## âš ï¸ **Special Cases to Watch**

### **System Dependencies**
```bash
# If you add a dependency that requires a system package
uv add opencv-python

# âš ï¸ Remember to update environment.yml manually:
# dependencies:
#   - opencv  # Conda version
```

### **Synchronizing environment.yml**
```bash
# After major changes, sync manually
# 1. Copy new dependencies from requirements/requirements-dev.txt
# 2. Add them to environment.yml under pip:
# 3. Test: conda env update -f environment.yml
```

## ğŸ¯ **Typical Workflow for a New Feature**

```bash
# 1. Create a branch
git checkout -b feature/new-feature

# 2. Add necessary dependencies
uv add requests>=2.31.0
uv add --dev pytest-mock>=3.15.0

# 3. Sync all files
make sync-deps

# 4. Develop and test
make test

# 5. Commit everything together
git add pyproject.toml uv.lock requirements*.txt
git commit -m "feat: add new feature with requests dependency"
```

## ğŸ”„ **Recommended Weekly Maintenance**

```bash
# Monday morning, 5 minutes:
make update-deps    # Update all dependencies
make test          # Verify everything works
git add .          # If all is good
git commit -m "chore: update dependencies"
```

## ğŸ› ï¸ **Debug Commands**

```bash
# See dependency tree
uv tree

# See installed versions
uv pip list

# See environment info
make env-info

# Rebuild environment
uv sync --reinstall
```

## ğŸ‰ **TL;DR - Your 3-Step Workflow**

1. **Always use UV**: `uv add`, `uv remove`, `uv sync`
2. **Sync**: `make sync-deps` after each change
3. **Maintain**: `make update-deps` once a week

**UV manages pyproject.toml and uv.lock, you sync the rest!** âœ¨